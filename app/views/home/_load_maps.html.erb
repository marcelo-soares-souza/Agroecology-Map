    lat = 16.0;
    lon = 1.0;
    zoom = 3.25;

    var collapsed = false;
    if (window.innerWidth < 1000) {
        collapsed = true;
    }

    if (window.devicePixelRatio > 2) {
        zoom = 3;
        lat = -1.00;
        lon = -32.00;
    }

    var map = L.map('map', { fullscreenControl: true, zoomControl: false, worldCopyJump: true, zoomSnap: 0.25 }).setView([lat, lon], zoom);

    L.control.scale().addTo(this.map);
    map.setMinZoom(2);
    map.setMaxZoom(18);

    $(document).ready(function () {
        $(window).on("resize", function () {
            $("#map").height($(window).height() - 80);
            map.invalidateSize();
        }).trigger("resize");
    });

  $(window).on('load', function () {
    // Base Maps
    var osm = L.tileLayer('https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '<span style="font-size: 10px"><a href="https://codeberg.org/marcelo-soares-souza/agroecology-map" target="_blank">Agroecology Map</a> | <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></span>',
        maxZoom: 18,
    }).addTo(map);

    var osmHot = L.tileLayer('https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        attribution: '<span style="font-size: 10px"><a href="https://codeberg.org/marcelo-soares-souza/agroecology-map" target="_blank">Agroecology Map</a> | <a href="https://www.hotosm.org/" target="_blank">HOT OSM</a> | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></span>',
        maxZoom: 18,
    });

    var mapbox = L.tileLayer('https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFyY2Vsb3NvYXJlc3NvdXphIiwiYSI6ImNpZ2NpNXFmMzNvaDh3Ym0zeXM3aWN3Y2EifQ.1xOQgKK1MioUioN0B4DVog', {
        attribution: '<span style="font-size: 10px"><a href="https://codeberg.org/marcelo-soares-souza/agroecology-map" target="_blank">Agroecology Map</a> | MapBox | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></span>',
        maxZoom: 18,
    });

    var baseMaps = {
        "<a href='https://www.openstreetmap.org/' target='_blank'>OpenStreetMap</a>": osm,
        "<a href='https://www.hotosm.org/' target='_blank'>Humanitarian OSM</a>": osmHot,
        "Satellite Mapbox": mapbox
    };

    $('.leaflet-container').css('cursor','crosshair');

    // OverLay Maps FUNAI
    var geoserver = 'https://funai.mapadaagroecologia.org/geoserver/ows?';
    var workspace = 'CMR-PUBLICO'
    var ti = L.tileLayer.wms(geoserver, {
        layers: workspace + ':' + 'lim_terra_indigena_a',
        format: 'image/png',
        transparent: true
    });
    var ai = L.tileLayer.wms(geoserver, {
        layers: workspace + ':' + 'loc_aldeia_indigena_p',
        format: 'image/png',
        transparent: true
    });
    // var ar = L.tileLayer.wms(geoserver, {
    //    layers: workspace + ':' + 'lim_assentamento_rural_a',
    //    format: 'image/png',
    //     transparent: true
    // });
    var uc = L.tileLayer.wms(geoserver, {
        layers: workspace + ':' + 'lim_unidade_conservacao_federal_a',
        format: 'image/png',
        transparent: true,
        opacity: 0.5
    });
    var quilombos = L.tileLayer.wms(geoserver, {
        layers: workspace + ':' + 'lim_quilombolas_a',
        format: 'image/png',
        transparent: true,
        opacity: 0.5
    });
    var biomas = L.tileLayer.wms(geoserver, {
        layers: workspace + ':' + 'veg_biomas_a',
        format: 'image/png',
        transparent: true,
        opacity: 0.3
    }).addTo(map);


    var ofb = loadOFB();
    var urgenci = loadURGENCI();

    ofb.addTo(map);
    urgenci.addTo(map)

    var philippines = L.kmzLayer();
    philippines.load('/philippines.kmz');

    var overlayMaps = {
        "<a href='https://cmr.funai.gov.br/geoserver' target='_blank'>Biomas</a>": biomas,
        "<a href='https://cmr.funai.gov.br/geoserver' target='_blank'>Terra Indígena</a>": ti,
        "<a href='https://cmr.funai.gov.br/geoserver' target='_blank'>Aldeias Indígenas</a>": ai,
        "<a href='https://cmr.funai.gov.br/geoserver' target='_blank'>Unidade de Conservação</a>": uc,
        "<a href='https://cmr.funai.gov.br/geoserver' target='_blank'>Quilombos</a>": quilombos,
        "<a href='https://www.google.com/maps/d/u/0/edit?mid=1c_yQmnWt0_IXzCxexx-xEEt_PqqcLmbm&usp=sharing' target='_blank'>Permaculture Map Philippines</a>": philippines,
        "<a href='https://urgenci.net' target='_blank'>URGENCI</a>": urgenci,
        "<a href='https://openfoodbrasil.com.br/' target='_blank'>Open Food Brasil</a>": ofb,
    };

    // OverLay Maps
    var omv = L.markerClusterGroup({ disableClusteringAtZoom: 12, maxClusterRadius: 32 });

    loadOMV().then(layer => {
        omv.addLayer(layer).addTo(map);
        Object.assign(overlayMaps, {"<a href='https://onemillionvoices.agroecologymap.org/' target='_blank'>One Million Voices</a>": omv});
        L.control.layers(baseMaps, overlayMaps, {collapsed: collapsed, position: 'bottomright'}).addTo(map);
    });
  });